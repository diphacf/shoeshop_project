{% extends "base.html" %}
{% block title %}Đăng nhập - ShoeStore{% endblock %}
{% block content %}
<!-- NAV BAR RIÊNG CHO TRANG LOGIN (BLACK / WHITE) -->
<style>
/* Ẩn navbar & footer mặc định của base chỉ ở trang login */
.navbar, footer {display:none !important;}
</style>
<header class="auth-nav">
  <nav class="auth-nav__inner">
    <div class="auth-brand">ShoeStore<span></span></div>
    <ul class="auth-links">
      <li><a href="{{ url_for('home') }}">Trang chủ</a></li>
      <li><a href="{{ url_for('giohang') }}">Giỏ hàng</a></li>
      <li><a href="{{ url_for('dangky') }}">Đăng ký</a></li>
      <li><a class="active" href="{{ url_for('login') }}">Đăng nhập</a></li>
    </ul>
  </nav>
</header>

<!-- NEW CLEAN MODERN LOGIN PAGE (BLACK/WHITE THEME) -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
/*********************************
  GLOBAL THEME: BLACK / WHITE
*********************************/
:root {--bg-deep:#0d0e11;--bg-panel:#14161b;--bg-panel-alt:#1d2026;--border:#2a2d34;--border-soft:#202228;--txt:#f5f7fa;--txt-dim:#b3b8c2;--accent:#ffffff;--focus:rgba(255,255,255,.25);--radius-xl:32px;--radius-lg:22px;--radius-md:14px;--transition: .5s cubic-bezier(.16,.8,.32,1)}
body{background:#0d0e11 !important;font-family:'Inter',sans-serif;color:var(--txt)}
/* Override container spacing của base */
.container.mt-4{padding:0;margin:0;max-width:100%;}

/*********************************
  CUSTOM AUTH NAVBAR
*********************************/
.auth-nav{position:fixed;top:0;left:0;width:100%;z-index:50;background:rgba(13,14,17,.65);backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);border-bottom:1px solid var(--border);}
.auth-nav__inner{max-width:1380px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:14px clamp(1rem,3vw,48px);}
.auth-brand{font-size:1.15rem;font-weight:700;letter-spacing:.05em;display:flex;align-items:center;gap:.4rem;color:var(--txt);}
.auth-brand span{font-weight:500;opacity:.5;font-size:.85rem}
.auth-links{list-style:none;display:flex;gap:2.2rem;margin:0;padding:0;align-items:center}
.auth-links a{position:relative;font-weight:500;text-decoration:none;color:var(--txt-dim);font-size:.8rem;letter-spacing:.15em;text-transform:uppercase;transition:var(--transition)}
.auth-links a:before{content:"";position:absolute;left:0;bottom:-8px;height:2px;width:0;background:var(--accent);transition:var(--transition);opacity:.9}
.auth-links a:hover{color:var(--txt)}
.auth-links a:hover:before{width:100%}
.auth-links a.active{color:var(--txt)}
.auth-links a.active:before{width:100%}
@media (max-width:780px){.auth-links{gap:1.25rem}.auth-links a{font-size:.7rem}}
@media (max-width:560px){.auth-links{display:none}}

/*********************************
  LOGIN LAYOUT (BLACK / WHITE)
*********************************/
.login-wrapper{padding-top:110px;min-height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 25% 20%,#1c2027 0%,#101216 60%,#0c0d10 100%);position:relative;overflow:hidden;}
/* sửa width=540px, height=540px, top=-130px,... */
.login-wrapper:before,.login-wrapper:after{content:"";position:absolute;width:540px;height:540px;border-radius:50%;filter:blur(140px);opacity:.18;z-index:0}
.login-wrapper:before{top:-130px;left:-120px;background:linear-gradient(135deg,#ffffff,#3a3f46)}
.login-wrapper:after{bottom:-180px;right:-140px;background:linear-gradient(135deg,#ffffff,#2d3238)}
.login-card{width:100%;max-width:1080px;display:grid;grid-template-columns:repeat(auto-fit,minmax(430px,1fr));background:linear-gradient(145deg,rgba(255,255,255,.04),rgba(255,255,255,.01));backdrop-filter:blur(28px);-webkit-backdrop-filter:blur(28px);border:1px solid var(--border);border-radius:var(--radius-xl);overflow:hidden;box-shadow:0 22px 55px -18px rgba(0,0,0,.85),0 0 0 1px rgba(255,255,255,.05);position:relative;z-index:1}
.login-visual{position:relative;padding:60px 54px;display:flex;flex-direction:column;justify-content:space-between;background:linear-gradient(160deg,rgba(255,255,255,.04),rgba(255,255,255,.01));border-right:1px solid var(--border-soft)}
@media (max-width:980px){.login-visual{border-right:none;border-bottom:1px solid var(--border-soft)}}
.login-visual h1{font-size:2.55rem;line-height:1.08;font-weight:800;margin:1.2rem 0 .75rem;color:var(--txt);letter-spacing:-.5px;background:linear-gradient(90deg,#fff,#c9ccd0);-webkit-background-clip:text;color:transparent}
.login-visual p.lead{font-size:.95rem;line-height:1.6;color:var(--txt-dim);max-width:360px;font-weight:500}
.brand-badge{background:rgba(255,255,255,.06);border:1px solid var(--border);color:var(--txt-dim);}
.feature-mini-grid{margin-top:2.1rem;display:grid;grid-template-columns:repeat(3,1fr);gap:1.15rem}
.feature-mini{padding:.85rem .75rem;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:18px;text-align:center;transition:var(--transition);position:relative;overflow:hidden}
.feature-mini:before{content:"";position:absolute;inset:0;background:linear-gradient(120deg,rgba(255,255,255,.15),rgba(255,255,255,0));opacity:0;transition:var(--transition)}
.feature-mini i{display:block;font-size:1.15rem;margin-bottom:.35rem;color:var(--txt)}
.feature-mini span{font-size:.6rem;font-weight:600;letter-spacing:.08em;color:var(--txt-dim);text-transform:uppercase}
.feature-mini:hover{transform:translateY(-6px);border-color:var(--accent);}
.feature-mini:hover:before{opacity:.35}

/* FORM SIDE */
.login-form-side{padding:60px 56px 56px;display:flex;flex-direction:column;gap:2.2rem;justify-content:center;position:relative}
@media (max-width:980px){.login-form-side{padding:54px 50px}}
@media (max-width:640px){.login-form-side{padding:42px 34px}}
.form-header h2{font-size:1.95rem;font-weight:800;background:linear-gradient(90deg,#fff,#d5d7da);-webkit-background-clip:text;color:transparent;letter-spacing:-.5px;margin:0}
.form-header p{color:var(--txt-dim);margin-top:.6rem;font-weight:500;font-size:.9rem}
.form-group{display:flex;flex-direction:column;gap:.55rem}
.form-group label{font-size:.68rem;font-weight:600;letter-spacing:.15em;text-transform:uppercase;color:var(--txt-dim);display:flex;align-items:center;gap:.45rem}
.input-shell{position:relative}
.input-shell input{width:100%;background:rgba(255,255,255,0.03);border:1px solid var(--border);color:var(--txt);font-size:.95rem;padding:1rem 1.1rem 1rem 3.1rem;border-radius:18px;font-weight:500;outline:none;transition:var(--transition);}
.input-shell input::placeholder{color:rgba(255,255,255,0.38)}
.input-shell input:focus{background:rgba(255,255,255,0.08);border-color:var(--accent);box-shadow:0 0 0 3px rgba(255,255,255,.15),0 15px 35px -15px rgba(0,0,0,.65)}
.input-icon{position:absolute;left:1rem;top:50%;transform:translateY(-50%);width:2.1rem;height:2.1rem;border-radius:14px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.08);color:#fff;font-size:.85rem;border:1px solid var(--border);}
.toggle-pass{position:absolute;right:.8rem;top:50%;transform:translateY(-50%);background:rgba(255,255,255,0.08);border:1px solid var(--border);color:#fff;width:40px;height:40px;border-radius:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition)}
.toggle-pass:hover{background:rgba(255,255,255,0.16);transform:translateY(-50%) scale(1.05)}
.helper-row{display:flex;justify-content:space-between;align-items:center;gap:1.5rem;margin-top:.1rem}
.checkbox-wrap{display:inline-flex;align-items:center;gap:.65rem;cursor:pointer;font-size:.72rem;font-weight:600;color:var(--txt-dim);user-select:none}
.checkbox-wrap input{appearance:none;width:20px;height:20px;border:2px solid var(--border);border-radius:7px;display:grid;place-items:center;background:rgba(255,255,255,0.03);transition:var(--transition)}
.checkbox-wrap input:checked{background:var(--accent);box-shadow:0 0 0 3px rgba(255,255,255,.2);border-color:var(--accent)}
.checkbox-wrap input:checked:after{content:"✔";font-size:.75rem;line-height:1;color:#000;font-weight:700}
.link-inline{color:var(--txt-dim);font-weight:600;font-size:.7rem;letter-spacing:.15em;text-transform:uppercase;position:relative;text-decoration:none}
.link-inline:after{content:"";position:absolute;left:0;bottom:-6px;width:0;height:2px;background:var(--accent);transition:var(--transition)}
.link-inline:hover{color:var(--txt)}
.link-inline:hover:after{width:100%}

/* BUTTON */
.btn-primary{position:relative;overflow:hidden;width:100%;border:none;border-radius:22px;padding:1.05rem 1.3rem;font-size:.85rem;font-weight:700;letter-spacing:.18em;text-transform:uppercase;background:linear-gradient(90deg,#ffffff 0%,#9ca3af 50%,#ffffff 100%);background-size:220% 100%;color:#000;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:.65rem;transition:var(--transition);box-shadow:0 12px 32px -12px rgba(0,0,0,.7),0 0 0 1px rgba(255,255,255,.05)}
.btn-primary:hover{background-position:100% 50%;transform:translateY(-4px);box-shadow:0 18px 48px -14px rgba(0,0,0,.85),0 0 0 1px rgba(255,255,255,.15)}
.btn-primary:active{transform:translateY(-1px) scale(.98)}
.btn-primary .loading-spinner{width:22px;height:22px;border:3px solid rgba(0,0,0,.25);border-top:3px solid #000;border-radius:50%;animation:spin .85s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* nút phụ */
.btn-secondary{margin-top:.85rem;width:100%;background:transparent;border:2px dashed var(--border);color:var(--accent);border-radius:22px;padding:1rem 1.1rem;font-size:.75rem;font-weight:700;letter-spacing:.18em;text-transform:uppercase;display:flex;align-items:center;justify-content:center;gap:.55rem;cursor:pointer;transition:var(--transition)}
.btn-secondary:hover{background:#fff;border-style:solid;transform:translateY(-3px);box-shadow:0 10px 28px -12px rgba(0,0,0,.18)}
.btn-secondary:active{transform:translateY(-1px)}

/* DIVIDER */
.divider{position:relative;text-align:center;font-size:.58rem;font-weight:600;letter-spacing:.3em;color:var(--txt-dim);margin:1.1rem 0 .25rem;text-transform:uppercase}
.divider:before,.divider:after{content:"";position:absolute;top:50%;width:42%;height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent)}
.divider:before{left:0}.divider:after{right:0}
.social-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:.75rem;margin-top:.9rem}
.social-btn{position:relative;border:1px solid var(--border);background:var(--bg-panel);color:var(--txt-dim);padding:.85rem .95rem;border-radius:16px;font-size:.75rem;font-weight:600;display:flex;align-items:center;justify-content:center;gap:.55rem;cursor:pointer;overflow:hidden;transition:var(--transition)}
.social-btn:hover{border-color:var(--accent);background:var(--bg-panel-alt);color:var(--txt);box-shadow:0 12px 32px -12px rgba(0,0,0,.75)}
.social-btn i{font-size:.9rem}
.alt-box{margin-top:.9rem;background:rgba(255,255,255,0.03);border:1px solid var(--border);padding:1.15rem 1.25rem;border-radius:20px;font-size:.8rem;font-weight:500;color:var(--txt-dim);text-align:center}
.alt-box a{color:var(--txt);font-weight:600;position:relative;text-decoration:none}
.alt-box a:after{content:"";position:absolute;left:0;bottom:-4px;width:0;height:2px;background:var(--accent);transition:var(--transition)}
.alt-box a:hover:after{width:100%}
.error-shake{animation:shake .45s cubic-bezier(.36,.07,.19,.97) both}
@keyframes shake{10%,90%{transform:translateX(-2px)}20%,80%{transform:translateX(4px)}30%,50%,70%{transform:translateX(-8px)}40%,60%{transform:translateX(8px)}}
.fade-in-up{opacity:0;transform:translateY(26px);animation:fadeUp .9s .15s forwards cubic-bezier(.16,.8,.32,1)}
@keyframes fadeUp{to{opacity:1;transform:translateY(0)}}
/* TOAST */
.inline-toast{font-family:'Inter',sans-serif}
</style>
<style id="light-theme-overrides">
/* ======================= LIGHT (TONE TRẮNG) OVERRIDES ======================= */
:root {
  --bg-deep:#f5f7fa; /* nền tổng thể */
  --bg-panel:#ffffff; /* panel chính */
  --bg-panel-alt:#f1f3f6; /* panel phụ / hover */
  --border:#d9dde3; /* viền chung */
  --border-soft:#e4e8ed;
  --txt:#1b1f24; /* màu chữ chính */
  --txt-dim:#6a727d; /* màu chữ phụ */
  --accent:#111111; /* điểm nhấn đen */
  --focus:rgba(0,0,0,.18);
}
body{background:radial-gradient(circle at 30% 20%,#ffffff 0%,#f1f4f7 55%,#e7ebef 100%) !important;color:var(--txt);}
.login-wrapper{background:radial-gradient(circle at 35% 25%,#ffffff 0%,#f2f5f8 55%,#e9edf1 100%);}/* nền tổng */
.login-wrapper:before{background:linear-gradient(135deg,#ffffff,#e4e8ed);opacity:.55;filter:blur(120px);} 
.login-wrapper:after{background:linear-gradient(135deg,#ffffff,#dde2e7);opacity:.45;filter:blur(120px);} 
.login-card{background:linear-gradient(145deg,rgba(255,255,255,.92),rgba(255,255,255,.86));backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid var(--border);box-shadow:0 18px 44px -14px rgba(27,31,36,.08),0 4px 18px -4px rgba(27,31,36,.06);} 
.login-visual{background:linear-gradient(160deg,#ffffff,#f3f5f8);border-right:1px solid var(--border-soft);} 
.brand-badge{background:#f1f4f7;color:var(--txt-dim);border:1px solid var(--border);}
.feature-mini{background:#f4f6f9;border:1px solid var(--border);}
.feature-mini:hover{border-color:var(--accent);background:#fff;}
.feature-mini i{color:var(--accent);} 
.feature-mini span{color:var(--txt-dim);} 
.login-visual h1{background:linear-gradient(90deg,#111,#555);-webkit-background-clip:text;color:transparent;}
.login-visual p.lead{color:var(--txt-dim);} 
.form-header h2{background:linear-gradient(90deg,#111,#333);-webkit-background-clip:text;color:transparent;}
.form-header p{color:var(--txt-dim);} 
.input-shell input{background:#f3f5f7;border:1px solid var(--border);color:var(--txt);} 
.input-shell input:focus{background:#ffffff;border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,0,0,.08),0 10px 25px -12px rgba(0,0,0,.14);} 
.input-icon{background:#ebeef2;border:1px solid var(--border);color:#111;} 
.toggle-pass{background:#edf0f3;border:1px solid var(--border);color:#111;} 
.toggle-pass:hover{background:#ffffff;} 
.checkbox-wrap{color:var(--txt-dim);} 
.checkbox-wrap input{background:#f3f5f7;border:2px solid var(--border);} 
.checkbox-wrap input:checked{background:var(--accent);box-shadow:0 0 0 3px rgba(0,0,0,.12);border-color:var(--accent);} 
.checkbox-wrap input:checked:after{color:#fff;} 
.link-inline{color:var(--txt-dim);} 
.link-inline:after{background:var(--accent);} 
.link-inline:hover{color:var(--accent);} 
.btn-primary{background:linear-gradient(90deg,#111 0%,#333 50%,#111 100%);color:#fff;box-shadow:0 12px 28px -14px rgba(0,0,0,.35);} 
.btn-primary .loading-spinner{border:3px solid rgba(255,255,255,.35);border-top:3px solid #fff;} 
.btn-primary:hover{box-shadow:0 18px 42px -18px rgba(0,0,0,.45);} 
.social-btn{background:#ffffff;border:1px solid var(--border);color:var(--txt-dim);} 
.social-btn:hover{background:#f5f7fa;color:var(--accent);border-color:var(--accent);box-shadow:0 8px 22px -10px rgba(0,0,0,.15);} 
.alt-box{background:#f5f7fa;border:1px solid var(--border);color:var(--txt-dim);} 
.alt-box a{color:var(--accent);} 
.inline-toast{background:#111 !important;border:1px solid #222 !important;} 
.auth-nav{background:rgba(255,255,255,.85);border-bottom:1px solid var(--border);backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);} 
.auth-links a{color:#6d737c;} 
.auth-links a:hover, .auth-links a.active{color:#111;} 
.auth-links a:before{background:#111;} 
</style>

<div class="login-wrapper">
    <div class="login-card fade-in-up">
        <div class="login-visual">
            <div>
                <span class="brand-badge"><i class="fas fa-bolt"></i> SHOESTORE</span>
                <h1>Chào Mừng<br>Trở Lại</h1>
                <p class="lead">Hệ thống quản lý & mua sắm giày hiện đại với trải nghiệm tinh gọn, tập trung vào hiệu suất và bảo mật.</p>
                <div class="feature-mini-grid">
                    <div class="feature-mini"><i class="fas fa-lock"></i><span>An toàn</span></div>
                    <div class="feature-mini"><i class="fas fa-rocket"></i><span>Nhanh</span></div>
                    <div class="feature-mini"><i class="fas fa-star"></i><span>Tinh gọn</span></div>
                </div>
            </div>
            <small style="opacity:.55;font-weight:500;letter-spacing:.05em;color:var(--txt-dim)">© 2025 ShoeStore</small>
        </div>
        <div class="login-form-side">
            {% with messages = get_flashed_messages(with_categories=true) %}
             {% if messages %}
              {% for category, message in messages %}
                <div class="inline-toast" style="position:relative;margin-bottom:12px;">
                 <i class="fas {% if category=='success' %}fa-check-circle{% else %}fa-exclamation-triangle{% endif %}"></i>
                 {{ message }}
                </div>
              {% endfor %}
             {% endif %}
            {% endwith %}
            <div class="form-header">
                <h2>Đăng Nhập</h2>
                <p>Nhập thông tin để tiếp tục phiên làm việc.</p>
            </div>
            <form id="loginForm" method="POST" action="{{ url_for('login_submit') }}">
                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i>Email</label>
                    <div class="input-shell">
                        <span class="input-icon"><i class="fas fa-at"></i></span>
                        <input id="email" name="email" type="email" placeholder="ban@example.com" autocomplete="username" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="password"><i class="fas fa-lock"></i>Mật khẩu</label>
                    <div class="input-shell">
                        <span class="input-icon"><i class="fas fa-key"></i></span>
                        <input id="password" name="password" type="password" placeholder="Nhập mật khẩu" autocomplete="current-password" required>
                        <button type="button" class="toggle-pass" id="togglePassword" aria-label="Hiện / Ẩn mật khẩu"><i class="fas fa-eye"></i></button>
                    </div>
                </div>
                <div class="helper-row">
                    <label class="checkbox-wrap">
                        <input type="checkbox" id="remember" name="remember">
                        <span>Ghi nhớ</span>
                    </label>
                    <a href="#" class="link-inline">Quên mật khẩu?</a>
                </div>
                <button id="loginBtn" type="submit" class="btn-primary">
                    <span class="btn-text"><i class="fas fa-sign-in-alt"></i> Đăng Nhập</span>
                </button>
                <div class="divider">hoặc</div>
                <div class="social-grid">
                    <button type="button" class="social-btn" data-social="google"><i class="fab fa-google"></i> Google</button>
                    <button type="button" class="social-btn" data-social="facebook"><i class="fab fa-facebook-f"></i> Facebook</button>
                </div>
                <div class="alt-box">Chưa có tài khoản? <a href="{{ url_for('dangky') }}">Tạo tài khoản mới</a></div>
            </form>
        </div>
    </div>
</div>
<script>
(function(){
    const form = document.getElementById('loginForm');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const btn = document.getElementById('loginBtn');
    const togglePassword = document.getElementById('togglePassword');

    // Toast function giống đăng ký
    function showToast(msg, type='info'){
        document.querySelectorAll('.inline-toast').forEach(t=>t.remove());
        const wrap=document.createElement('div');
        wrap.className='inline-toast';
        wrap.style.cssText='position:fixed;top:26px;right:26px;z-index:9999;display:flex;align-items:center;gap:.85rem;background:#111;color:#fff;padding:.95rem 1.15rem;border:1px solid #222;border-radius:18px;font-weight:600;animation:toastIn .45s var(--transition)';
        const icons={success:'fa-check-circle',error:'fa-exclamation-triangle',info:'fa-info-circle'};
        wrap.innerHTML=`<i class="fas ${icons[type]||icons.info}" style="font-size:1.05rem"></i>
                        <span style="font-size:.85rem">${msg}</span>
                        <button style='background:rgba(255,255,255,.08);border:1px solid #222;color:#fff;padding:.4rem .65rem;border-radius:10px;cursor:pointer;font-size:.6rem;font-weight:600;letter-spacing:.12em'>ĐÓNG</button>`;
        wrap.querySelector('button').onclick=()=>wrap.remove();
        document.body.appendChild(wrap);
        setTimeout(()=>{wrap.style.animation='toastOut .4s forwards'; setTimeout(()=>wrap.remove(),380)},4200);
    }
    const toastKF=document.createElement('style');
    toastKF.textContent='@keyframes toastIn{from{transform:translateY(-14px);opacity:0}to{transform:translateY(0);opacity:1}}@keyframes toastOut{to{transform:translateY(-10px);opacity:0}}';
    document.head.appendChild(toastKF);

    // Hiện/ẩn mật khẩu
    togglePassword.addEventListener('click',()=>{
        const t=password.type==='password'?'text':'password';
        password.type=t;
        togglePassword.firstElementChild.classList.toggle('fa-eye');
        togglePassword.firstElementChild.classList.toggle('fa-eye-slash');
    });

    form.addEventListener('submit', async (e)=>{
        e.preventDefault();

        // disable button + loading
        btn.disabled = true;
        btn.dataset.original = btn.innerHTML;
        btn.innerHTML = '<span class="loading-spinner"></span> Đang xử lý...';

        const formData = new FormData(form);

        try {
            const res = await fetch("{{ url_for('login_submit') }}", {
                method: "POST",
                body: formData
            });
            const data = await res.json();

            if(data.success){
                showToast(data.message || "Đăng nhập thành công!", "success");
                setTimeout(()=>window.location.href = "{{ url_for('home') }}", 2000);
            } else {
                showToast(data.message || "Email hoặc mật khẩu không đúng!", "error");
                btn.disabled = false;
                btn.innerHTML = btn.dataset.original;
            }
        } catch(err){
            showToast("Có lỗi kết nối server!", "error");
            btn.disabled = false;
            btn.innerHTML = btn.dataset.original;
        }
    });
})();
</script>
{% endblock %}